<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Admin Panel - Contractor Leads</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.v2.css') }}?v=5">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('login') }}">Login</a>
            <a href="{{ url_for('signup') }}">Sign Up</a>
        </div>
    </nav>
    <nav>
        <div class="nav-container">
            <h1>Admin Panel</h1>
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </nav>

    <main>
        <section class="admin-controls">
            <button id="view-payments">View Payments</button>
            <button id="export-csv">Export CSV</button>
            <button id="test-deploy">Test Deploy</button>
        </section>

        <section class="cities-toggle">
            <h2>Toggle Cities</h2>
            <div class="toggle-list">
                <label><input type="checkbox" checked> Chattanooga</label>
                <label><input type="checkbox" checked> Austin</label>
                <label><input type="checkbox" checked> Bexar</label>
                <label><input type="checkbox" checked> Nashville</label>
            </div>
        </section>

        <section class="leads-table">
            <h2>Leads</h2>
            <table>
                <thead>
                    <tr>
                        <th>County</th>
                        <th>Permit Number</th>
                        <th>Address</th>
                        <th>Type</th>
                        <th>Value</th>
                        <th>Description</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lead in master %}
                    <tr>
                        <td>{{ lead.city }}</td>
                        <td>{{ lead.permit_number }}</td>
                        <td>{{ lead.address }}</td>
                        <td>{{ lead.permit_type }}</td>
                        <td>{{ lead.estimated_value }}</td>
                        <td>{{ lead.work_description }}</td>
                        <td>{{ lead.pull_time }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </main>

    <script>
        document.getElementById('view-payments').addEventListener('click', () => {
            window.open('https://dashboard.stripe.com/payments', '_blank');
        });
        document.getElementById('export-csv').addEventListener('click', () => {
            window.location.href = '{{ url_for("download_all_permits") }}';
        });
        document.getElementById('test-deploy').addEventListener('click', () => {
            fetch('/admin/test-deploy', { method: 'POST' })
            .then(response => response.json())
            .then(data => alert(data.message));
        });
    </script>
</body>
</html>
